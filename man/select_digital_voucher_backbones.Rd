% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/select_digital_voucher_backbones.R
\name{select_digital_voucher_backbones}
\alias{select_digital_voucher_backbones}
\title{Selecting the master digital voucher with multiple backbones}
\usage{
select_digital_voucher_backbones(
  occ_tmp = NA,
  occ_gbif_issue = NA,
  occ_wcvp_check_name = NA,
  occ_flora_funga_brasil_name = NA,
  occ_collectorsDictionary = NA,
  enumOccurrenceIssue = NA,
  silence = FALSE,
  backbone = "WCVP"
)
}
\arguments{
\item{occ_tmp}{GBIF occurrence table with selected columns as returned by \code{select_gbif_fields(columns = 'standard')}.}

\item{occ_gbif_issue}{Data frame. Result of function \code{extract_gbif_issue()$occ_gbif_issue}.}

\item{occ_wcvp_check_name}{Data frame. Result of function \code{batch_checkName_wcvp()$occ_wcvp_check_name}.}

\item{occ_flora_funga_brasil_name}{Data frame. Result of function \code{batch_checkName_flora_funga_brasil()$occ_flora_funga_brasil_name}.
Required when using 'FFB' backbone.}

\item{occ_collectorsDictionary}{Data frame. Result of function \code{update_collectorsDictionary()$occ_collectorsDictionary}.}

\item{enumOccurrenceIssue}{Data frame. An enumeration of validation rules for single occurrence records by GBIF.
If NA, will use built-in data(EnumOccurrenceIssue).}

\item{silence}{Logical. If \code{TRUE}, does not display progress messages. Default is \code{FALSE}.}

\item{backbone}{Character. Taxonomic backbone to use:
\itemize{
\item \code{'WCVP'}: World Checklist of Vascular Plants (default)
\item \code{'FFB'}: Flora Funga Brasil
}}
}
\value{
Returns a list with two data frames:
\itemize{
\item \code{occ_digital_voucher}: Processed data with all fields
\item \code{occ_results}: Data with only result fields
}
}
\description{
To group duplicates and choose the digital voucher using multiple taxonomic backbones:
Unique collection events can result in many 'duplicate' GBIF records. We designate one of these 'duplicate' records
as the master digital voucher, to which data from other duplicate vouchers can be merged (see export_data):

\strong{Where the collection event key for grouping duplicates is complete}, then duplicates can be grouped / parsed.
To do so, we evaluate record completeness. Record completeness is calculated based on data-quality scores
for the information in the following fields: recordedBy, recordNumber, year, institutionCode, catalogNumber, locality, municipality,
countryCode, stateProvince and fieldNotes. The spatial coordinates associated with each duplicate are ranked using a score for the
quality of the geospatial information. This score is calculated using the issues listed in the GBIF table, EnumOccurrenceIssue.
A score is calculated based on these issues (see above). The duplicate with the highest total score is assigned as the master voucher
for the unique collection event. Missing information contained in duplicate records of the unique collection event can then be merged
into the master digital voucher (see export_data).

\strong{Where the collection event key is incomplete}, unique collection event duplicates cannot be parsed. In this case,
each record is considered as a unique collection event, without duplicates. However, to know the integrity
of the information, record completeness and quality of the geospatial information, are evaluated as described above.

\strong{How is the quality score calculated?}
parseGBIF_digital_voucher = The duplicate with the highest total score, sum of record completeness + quality of geospatial information.

\strong{How is record completeness calculated?}
The quality of the duplicate records associated with each collection event key is measured as the
completeness of a record, using the sum of a number of flags (see below) equal to TRUE.

\strong{Flags used to calculate record completeness}
\itemize{
\item Is there information about the collector?
\item Is there information about the collection number?
\item Is there information about the year of collection?
\item Is there information about the institution code?
\item Is there information about the catalog number?
\item Is there information about the locality?
\item Is there information about the municipality of collection?
\item Is there information about the state/province of collection?
\item Is there information about the field notes?
}

\strong{The quality of geospatial information is based on geographic issues raised by GBIF.}
GIBF issues relating to geospatial data were classified into three classes based on the data quality
scores that we assigned to each of the following GBIF issues recorded in the EnumOccurrenceIssue.
\itemize{
\item Issue does not affect coordinating accuracy, with selection_score equal to -1
\item Issue has potential to affect coordinate accuracy, with selection_score equal to -3
\item Records with a selection_score equal to -9 are excluded.
}
}
\details{
\itemize{
\item parseGBIF_duplicates_grouping_status - "groupable", "not groupable: no recordedBy and no recordNumber",
"not groupable: no recordNumber" or "not groupable: no recordedBy"
\item parseGBIF_num_duplicates number of duplicates records
\item parseGBIF_duplicates TRUE/FALSE
\item parseGBIF_non_groupable_duplicates TRUE/FALSE
}

This extended version supports multiple taxonomic backbones for name verification and
processing, allowing flexibility in taxonomic reference systems.
}
\examples{
\donttest{
# Load required data
data(occ)
data(res_gbif_issue)
data(res_checkName_wcvp) 
data(res_checkName_ffb)
data(res_collectorsDictionary)
data(EnumOccurrenceIssue)

# Select digital voucher using WCVP backbone
res_digital_voucher_wcvp <- select_digital_voucher_backbones(
  occ_tmp = occ,
  occ_gbif_issue = res_gbif_issue$occ_gbif_issue,
  occ_wcvp_check_name = res_checkName_wcvp$occ_wcvp_check_name,
  occ_collectorsDictionary = res_collectorsDictionary$occ_collectorsDictionary,
  enumOccurrenceIssue = EnumOccurrenceIssue,
  backbone = 'WCVP'
)

# Select digital voucher using FFB backbone  
res_digital_voucher_ffb <- select_digital_voucher_backbones(
  occ_tmp = occ,
  occ_gbif_issue = res_gbif_issue$occ_gbif_issue,
  occ_flora_funga_brasil_name = res_checkName_ffb$occ_flora_funga_brasil_name,
  occ_collectorsDictionary = res_collectorsDictionary$occ_collectorsDictionary,
  enumOccurrenceIssue = EnumOccurrenceIssue,
  backbone = 'FFB'
)

# View results
names(res_digital_voucher_wcvp)
head(res_digital_voucher_wcvp$occ_digital_voucher)
}

}
\seealso{
\code{\link[=batch_checkName_wcvp]{batch_checkName_wcvp()}} for name checking against WCVP,
\code{\link[=batch_checkName_flora_funga_brasil]{batch_checkName_flora_funga_brasil()}} for name checking against Flora Funga Brasil,
\code{\link[=extract_gbif_issue]{extract_gbif_issue()}} for extracting GBIF data quality issues
}
\author{
Pablo Hendrigo Alves de Melo,
Nadia Bystriakova &
Alexandre Monro
}
